(()=>{"use strict";var e=new Set;chrome.webRequest.onBeforeRequest.addListener((function(r){var o,n=(o=r.url).includes("myqcloud.com")&&o.includes(".mp4")&&o.includes("recording")?o:null;n&&(e.add(n),chrome.storage.local.set({videoUrls:Array.from(e)}))}),{urls:["*://*.myqcloud.com/*recording*.mp4*"],types:["media","xmlhttprequest"]}),chrome.webRequest.onBeforeSendHeaders.addListener((function(e){return{requestHeaders:e.requestHeaders.filter((function(e){return!["range","if-range"].includes(e.name.toLowerCase())}))}}),{urls:["*://*.myqcloud.com/*recording*.mp4*"]},["blocking","requestHeaders"]),chrome.runtime.onMessage.addListener((function(e,r,o){return"getVideoUrls"===e.action?(chrome.storage.local.get(["videoUrls"],(function(e){o({videoUrls:e.videoUrls||[]})})),!0):"executeDownload"===e.action?(chrome.downloads.download({url:e.url,filename:e.filename,saveAs:!0,headers:[{name:"Accept",value:"*/*"},{name:"Referer",value:"https://meeting.tencent.com/"},{name:"Sec-Fetch-Dest",value:"video"}]},(function(e){chrome.runtime.lastError?console.error("下载错误：",chrome.runtime.lastError):chrome.downloads.onChanged.addListener((function r(o){o.id===e&&(o.state&&"complete"===o.state.current?(console.log("下载完成"),chrome.downloads.onChanged.removeListener(r)):o.error&&(console.error("下载失败：",o.error.current),chrome.downloads.onChanged.removeListener(r)))}))})),!0):void 0})),chrome.tabs.onRemoved.addListener((function(){e.clear(),chrome.storage.local.remove("videoUrls")}))})();